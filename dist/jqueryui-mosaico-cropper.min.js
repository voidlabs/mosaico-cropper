!function(i){"function"==typeof define&&define.amd?define(i):i()}(function(){"use strict";const i={encodedUrlOriginal:"[^ &\\?]+",width:"[0-9]+",height:"[0-9]+",resizeWidth:"[0-9]+",resizeHeight:"[0-9]+",offsetX:"[0-9]+",offsetY:"[0-9]+",cropWidth:"[0-9]+",cropHeight:"[0-9]+",cropX:"[0-9]+",cropY:"[0-9]+",cropX2:"[0-9]+",cropY2:"[0-9]+"},t=["original","resize","cover","cropresize","resizecrop"];function e(t,e,o){var r=[],n=new RegExp("^"+t.replace(/\\.|(\((?!\?[!:=]))|\{([^:\}]+)(?::([^\}]+))?\}/g,function(n,a,c,h,d,s){if(a)return r.push(""),n;if(c){if(r.push(c),h||(i[c]?h=i[c]:void 0!==e&&e[c]&&(h=e[c])),h)return h.replace(/\\.|(\((?!\?[!:=]))/g,function(i,t){return t&&r.push(""),n}),"("+h+")";throw console.error(t,o,e),"Uknown token "+c+", please use {"+c+":regex} or use a known pattern"}return n})+"$"),a=o.match(n),c=null;if(null!==a){a.length!==r.length+1&&console.log("ERROR parsing image url according to pattern!",t,r,a),c={};for(var h=0;h<r.length;h++)""!==r[h]&&void 0!==a[h+1]&&(c[r[h]]=a[h+1])}return c}function o(i,t){return i.replace(/\{([^[\}:]+)(?::[^\}]+)?\}/g,function(i,e,o,r){return t.hasOwnProperty(e)?void 0!==t[e]?t[e]:"":i})}var r;(r=jQuery).widget("mosaico.mosaicoCropper",{options:{autoClose:!0,shiftWheel:!1},_init:function(){void 0!==this.options.instance&&this.options.instance.dispose(!0),this.options.instance=function(i,n,a){function c(i){return{width:Math.round(K.width*(i||ti.scale)),height:Math.round(K.height*(i||ti.scale))}}function h(){return ti.crop.Height}function d(){return ti.scale}function s(){return void 0!==n.maxScale?n.maxScale:2}var l,p=!1,u=!1;function f(i){p&&clearTimeout(p),u||($.addClass("cropper-moving"),$.addClass("cropper-moving-"+i),u=i)}function g(){p&&clearTimeout(p),u&&($.removeClass("cropper-moving"),$.removeClass("cropper-moving-"+u),u=!1)}function v(i){u?g():f(i)}function m(i,t,e){return i<t?t:i>e?e:i}function w(i){if(ti.scale!==i){ti.scale=i;var t=c(),e={width:t.width+"px",height:t.height+"px"};return N.css(e),Z.css(e),!0}return!1}function M(i,t){ti.crop.height=parseInt(i),void 0!==t&&(ti.crop.width=parseInt(t),$.css({width:ti.crop.width+"px"})),Q.css({height:ti.crop.height+"px",width:ti.crop.width+"px"});var e=n.width/K.width,o=ti.crop.height/K.height,r=Math.max(e,o);r!==ti.minScale&&(ti.minScale=r,q.slider({min:O(r)}))}function C(i,t,e,o,r){var n=!1;void 0!==e&&(n=w(e));var a=c();if(void 0!==i&&(i=m(i,ti.crop.width-a.width,0),ti.container.left!==i&&(ti.container.left=i,n=!0)),void 0!==t&&(t=m(t,ti.crop.height-a.height,0),ti.container.top!==t&&(ti.container.top=t,n=!0)),n){var h={left:ti.container.left+"px",top:ti.container.top+"px"};(void 0===o||o)&&Z.css(h),N.css(h),e&&!1!==r&&q.slider("value",O(e))}return n}function x(){var i,t=c(i=ti.minScale);return C(Math.round((ti.crop.width-t.width)/2),Math.round((ti.crop.height-t.height)/2),i)}function z(i,t,e,o){var r=c();if(null==t&&(t=(ti.crop.width/2-ti.container.left)/r.width),null==e&&(e=(ti.crop.height/2-ti.container.top)/r.height),(i=m(i,ti.minScale,s()))!==ti.scale){var n=c(i),a=Math.round((n.width-r.width)*t),h=Math.round((n.height-r.height)*e);return C(ti.container.left-a,ti.container.top-h,i,void 0,o),!0}return!1}function b(i,t,e,o,r){if(!n.autoZoom&&t>r&&(t=r),M(t=Math.round(t)),"original"==i||"cover"==i||"resize"==i)x();else if(t>r)z(t/K.height);else{var a=Math.round((t-e)/2)+o;a>0&&(a=0),C(void 0,a)}}function y(i){var t=ti.crop.height;return b(T(),i,t,ti.container.top,c().height),t!==ti.crop.height}function H(){var i=n.width/K.width,t=y(Math.round(K.height*i));return t=z(i)||t}function S(){var i=x();i||(i=H())||z(1),R()}function W(){var i,t,e;Q.append('<div class="clip-handle ui-resizable-s"></div>'),Q.resizable({minHeight:40,handles:{s:".clip-handle"},start:function(o,r){$.focus(),f("handle"),i=ti.container.top,e=T(),t=c().height},stop:function(i,t){g(),R()},resize:function(o,r){b(e,r.size.height,r.originalSize.height,i,t),R(),r.size.height=ti.crop.height,void 0!==a&&a._trigger("cropheight",null,{value:ti.crop.height})}}),Q.find(".clip-handle").on("dblclick",function(i){return y(c().height),R(),!1})}function X(){Z.draggable({scroll:!1,start:function(i,t){$.focus(),f("drag")},stop:function(i,t){R(),g()},drag:function(i,t){C(Math.round(t.position.left),Math.round(t.position.top),void 0,!1),t.position.left=ti.container.left,t.position.top=ti.container.top,R()}}).on("wheel",function(i){if(n.shiftWheel&&!i.shiftKey)return!0;var t=-i.originalEvent.deltaY;if($.focus(),0!==t){f("wheel"),p=setTimeout(g,500);var e=c(),o=i.originalEvent.offsetX/e.width,r=i.originalEvent.offsetY/e.height;z(t>0?1.1*ti.scale:ti.scale/1.1,o,r),R()}return!1}).on("dblclick",function(i){return S(),!1}).on("click",function(i){$.focus(),v("click")})}function Y(i){return Math.pow(1.03,i)/100}function O(i){return Math.log(100*i)/Math.log(1.03)}function P(){q.slider({min:Math.floor(O(ti.minScale)),step:1,value:Math.round(O(ti.scale)),max:Math.ceil(O(s())),slide:function(i,t){z(Y(t.value),void 0,void 0,!1),R(),t.value=O(ti.scale)},start:function(){f("slide")},stop:function(){g()}})}function k(){var i,t,e,o,r;if(void 0!==n.ppp&&(n.width=Math.round(n.width/n.ppp),void 0!==n.height&&(n.height=Math.round(n.height/n.ppp)),void 0!==n.resizeWidth&&(n.resizeWidth=Math.round(n.resizeWidth/n.ppp)),void 0!==n.resizeHeight&&(n.resizeHeight=Math.round(n.resizeHeight/n.ppp)),void 0!==n.offsetX&&(n.offsetX=Math.round(n.offsetX/n.ppp)),void 0!==n.offsetY&&(n.offsetY=Math.round(n.offsetY/n.ppp))),void 0!==n.resizeWidth)o=n.resizeWidth/K.width,i=n.height,r=n.width,t=-n.offsetX,e=-n.offsetY;else if(void 0!==n.cropX2||void 0!==n.cropWidth)null==n.cropWidth&&(n.cropWidth=n.cropX2-n.cropX),null==n.cropHeight&&(n.cropHeight=n.cropY2-n.cropY),null==n.cropX&&(n.cropX=0),null==n.cropY&&(n.cropY=0),o=n.width/n.cropWidth,i=n.height||n.cropHeight*o,r=n.width,t=Math.round(-n.cropX*o),e=Math.round(-n.cropY*o);else if(void 0!==n.height){o=Math.max(n.width/K.width,n.height/K.height),r=Math.min(n.width,Math.round(K.width*o)),i=Math.min(n.height,Math.round(K.height*o));var a=c(o);t=Math.round((r-a.width)/2),e=Math.round((i-a.height)/2)}else n.width,o=n.width/K.width,i=Math.round(K.height*o),r=n.width,t=0,e=0;M(i,r),C(t,e,o),L()}function U(){ii&&ii.addClass("cropper-cropping"),!1!==n.autoClose&&$.focusout(function(i){null!=i.relatedTarget&&$.get(0).contains(i.relatedTarget)||void 0!==i.delegatedTarget||J||_()}),$.find(".tool-crop").on("click",function(){_()}),$.find(".tool-zoom").on("click",function(){S()}),$.focus(),k(),W(),X(),P(),r(i).css("display","none"),$.css("display","inline"==B?"inline-block":B),$.removeClass("cropper-hidden"),$.focus(),void 0!==a&&a._trigger("copperready")}function L(){var i=T();l!==i&&($.removeClass("cropper-method-"+l),l=i,$.addClass("cropper-method-"+l))}function R(){L(),$.addClass("cropper-has-changes")}function T(){return I().method}function I(){var i=c(),t=i.width,e=i.height,o=ti.scale,r=-ti.container.left,a=t-ti.crop.width+ti.container.left,h=-ti.container.top,d=e-ti.crop.height+ti.container.top,s=1;void 0!==n.ppp&&(s=n.ppp),s*o>1&&(s=Math.ceil(1/o));var l={resizeWidth:Math.round(t*s),resizeHeight:Math.round(e*s),offsetX:Math.round(Math.max(0,-ti.container.left)*s),offsetY:Math.round(Math.max(0,-ti.container.top)*s),cropX:Math.max(0,Math.round(r/o)),cropY:Math.max(0,Math.round(h/o)),cropWidth:Math.round(ti.crop.width/o),cropHeight:Math.round(ti.crop.height/o),width:Math.round(ti.crop.width*s),height:Math.round(ti.crop.height*s),_scale:o};l.cropX2=l.cropX+l.cropWidth,l.cropY2=l.cropY+l.cropHeight;var p=Math.abs(r-a),u=Math.abs(h-d);return l.method=void 0!==n.resizeWidth?"resizecrop":"cropresize",p<=1&&u<=1&&(0===r||0===h)&&(l.method=0===r&&0===h?1!==o?"resize":"original":"cover"),l}function E(e,a){try{var c=I(),h=function(i,e,r){r.urlPrefix=e.urlPrefix,r.urlPostfix=e.urlPostfix,r.urlOriginal=e.urlOriginal,r.encodedUrlOriginal=encodeURIComponent(e.urlOriginal);var n=i.toSrc;if("object"==typeof n)for(var a=t.indexOf(r.method);a<t.length;a++)if(void 0!==n[t[a]]){n=n[t[a]];break}return"string"==typeof n&&(n=o.bind(void 0,n)),n(r)}(n.urlAdapter,n,c);$.addClass("cropper-loading"),A(h,function(t,o){r(i).attr("src",o),$.removeClass("cropper-loading"),e()},function(i){$.removeClass("cropper-loading"),$.addClass("cropper-has-changes"),a()}),$.removeClass("cropper-has-changes"),n.imgLoadingClass&&r(i).removeClass(n.imgLoadingClass)}catch(d){console.error("Failed generating final URL",d),a()}}function _(){V||(V=!0,E(j,function(){j(),V=!1}))}function j(t){if(!J){J=!0,ii&&ii.removeClass("cropper-cropping");try{Q.find(".clip-handle").remove(),Q.resizable("destroy"),Z.draggable("destroy"),q.slider("destroy")}catch(e){}$.remove(),n.imgLoadingClass&&r(i).removeClass(n.imgLoadingClass),r(i).css("display",B),t||void 0===a||a.destroy()}}function A(i,t,e){var o=new Image;o.onload=function(){t(o,i)},o.onerror=function(t){console.log("TODO img preload failed",t),e&&e(i)},o.src=i}var $=r('<div class="mo-cropper cropper-hidden" tabindex="-1"><div class="cropper-frame"><div class="clipping-container"><div class="toolbar"><div class="tool tool-zoom"><i class="fa fa-compress" aria-hidden="true"></i></div><div class="copper-zoom-slider"></div><div class="tool tool-crop"><i class="fa fa-check" aria-hidden="true"></i></div></div><img draggable="false" class="clipped clipped-image original-src"></div></div><div class="outer-image-container"><img class="outer-image original-src"></div></div>');r(i).before($),n.imgLoadingClass&&r(i).addClass(n.imgLoadingClass);var D=function(i,t,o){var r=i.fromSrc;if("object"==typeof r){var n=i.toSrc,a=[];for(var c in n)n.hasOwnProperty(c)&&a.push(n[c].replace(/[.*+?^$()|[\]\\]/g,"\\$&"));var h="("+a.join("|")+")",d=r;r=e.bind(void 0,h,d)}"string"==typeof r&&(r=e.bind(void 0,r,void 0));var s=r(o);return s?s.encodedUrlOriginal&&(s.urlOriginal=decodeURIComponent(s.encodedUrlOriginal)):void 0!==i.defaultPrefix?(t.urlOriginal=o,t.urlPrefix=i.defaultPrefix,t.urlPostfix=o):console.error("FAILED PARSING",o),s}(n.urlAdapter,n,i.src);r.extend(n,D),n.width||(n.width=i.width,n.height=i.height);var F=n.width/i.width,G=n.height?n.height/i.height:F;Math.abs(F/G-1)>.01&&console.error("Unexpected aspect ratio: ",n.width,n.height,i.width,i.height,F,G),n.ppp=F;var K,N=$.find(".clipped"),Q=$.find(".cropper-frame"),Z=$.find(".outer-image-container"),q=$.find(".copper-zoom-slider"),B=r(i).css("display"),J=!1,V=!1,ii=!1;void 0!==n.containerSelector&&(ii=r(n.containerSelector));var ti={container:{},crop:{}},ei=n.urlOriginal||(n.urlPrefix||"")+(n.urlPostfix||"");return ei.match(/[a-z]+:/)||(ei="http://"+ei),A(ei,function(i,t){$.find(".original-src").attr("src",t),K={width:i.naturalWidth,height:i.naturalHeight},U()},function(i){setTimeout(j)}),{getScale:d,updateScale:z,getCropHeight:h,updateCropHeight:y,dispose:j}}(this.element.get(0),this.options,this)},scale:function(i){if(void 0===i)return this.options.instance.getScale();this.options.instance.updateScale(i)},cropHeight:function(i){if(void 0===i)return this.options.instance.getCropHeight();this.options.instance.updateCropHeight(i)},_destroy:function(){this.options.instance.dispose(!0)}})});
//# sourceMappingURL=jqueryui-mosaico-cropper.min.js.map
